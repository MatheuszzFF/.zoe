---
description: 
globs: 
alwaysApply: false
---
# Banco de Dados

## Princípios Fundamentais

### 1. Modelagem de Dados
- Normalização até 3NF
- Chaves primárias e estrangeiras
- Índices apropriados
- Constraints de integridade
- Tipos de dados otimizados

### 2. Queries
```sql
-- Exemplo de query otimizada
SELECT 
  u.id,
  u.name,
  u.email,
  COUNT(p.id) as post_count
FROM users u
LEFT JOIN posts p ON u.id = p.user_id
WHERE u.active = true
GROUP BY u.id, u.name, u.email
HAVING COUNT(p.id) > 0
ORDER BY post_count DESC
LIMIT 10;
```

### 3. Transações
```typescript
// Exemplo de transação
await prisma.$transaction(async (tx) => {
  const user = await tx.user.create({
    data: userData
  })
  
  await tx.profile.create({
    data: {
      ...profileData,
      userId: user.id
    }
  })
})
```

### 4. Migrations
```typescript
// Exemplo de migration
export async function up(prisma: PrismaClient) {
  await prisma.schema.createTable('users', (table) => {
    table.uuid('id').primaryKey()
    table.string('name').notNull()
    table.string('email').unique().notNull()
    table.timestamp('created_at').defaultNow()
  })
}

export async function down(prisma: PrismaClient) {
  await prisma.schema.dropTable('users')
}
```

### 5. Performance
- Índices otimizados
- Queries otimizadas
- Particionamento quando necessário
- Cache de consultas frequentes
- Monitoramento de performance

### 6. Backup e Recuperação
- Backups automáticos
- Point-in-time recovery
- Testes de recuperação
- Retenção configurável
- Documentação de procedimentos

### 7. Segurança
- Criptografia em trânsito
- Criptografia em repouso
- Controle de acesso
- Audit logs
- Sanitização de inputs

### 8. Monitoramento
- Métricas de performance
- Alertas de capacidade
- Logs de queries lentas
- Monitoramento de conexões
- Análise de uso

### 9. Manutenção
- Rotinas de manutenção
- Limpeza de dados
- Otimização de índices
- Atualizações de schema
- Documentação de mudanças

### 10. Escalabilidade
- Sharding quando necessário
- Replicação
- Load balancing
- Cache distribuído
- Arquitetura distribuída

