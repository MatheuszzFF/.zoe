{
  "_metadata": {
    "action_name": "context-checker",
    "version": "1.0",
    "format": "json",
    "description": "Verifica√ß√£o AUTOM√ÅTICA de contexto antes de qualquer comando - SEMPRE executada",
    "created": "2025-01-20",
    "converted_from": "context-checker.mdc",
    "ai_optimized": true
  },
  
  "trigger": {
    "patterns": [
      "IMEDIATO: Qualquer comando que mencione projeto ou 'zoe iniciar'",
      "SEMPRE antes de qualquer comando ou resposta",
      "zoe iniciar [projeto]",
      "zoe, iniciar [projeto]"
    ],
    "automatic": true,
    "priority_level": 0,
    "category": "context-management",
    "mandatory": true,
    "blocking": true
  },

  "behavior": {
    "description": "Verifica√ß√£o autom√°tica e cria√ß√£o obrigat√≥ria de estrutura de contexto",
    "critical_rule": "SEMPRE CRIAR ESTRUTURA COMPLETA, MESMO SE J√Å EXISTIR PROJETO",
    "execution_steps": [
      {
        "step": 1,
        "action": "analyze_command",
        "description": "Detectar padr√µes de comando e projeto solicitado",
        "patterns": [
          "zoe, iniciar [nome-projeto]",
          "zoe iniciar [nome-projeto]",
          "iniciar [nome-projeto]", 
          "Qualquer comando que mencione nome de projeto",
          "Comandos em projeto diferente do ativo"
        ],
        "project_extraction": {
          "regex_patterns": [
            "(?:zoe,?\\s+)?iniciar\\s+([a-zA-Z0-9-_]+)",
            "(?:zoe,?\\s+)?iniciar\\s+([a-zA-Z0-9-_]+)(?:\\s|$)",
            "set project\\s+([a-zA-Z0-9-_]+)",
            "projeto\\s+([a-zA-Z0-9-_]+)"
          ],
          "fallback_detection": [
            "Verificar package.json se n√£o houver nome expl√≠cito",
            "Usar nome da pasta atual como √∫ltimo recurso"
          ]
        }
      },
      {
        "step": 2,
        "action": "verify_context",
        "description": "Verificar estado atual do contexto",
        "validations": [
          "Projeto solicitado == active-project.json",
          "Estrutura context/projects/[projeto]/ existe",
          "project-context.json existe e est√° atualizado",
          "Pasta progress/[hoje]/ existe",
          "Contexto carregado est√° correto"
        ]
      },
      {
        "step": 3,
        "action": "automatic_correction",
        "description": "Corre√ß√£o autom√°tica se necess√°rio",
        "conditions": [
          "Se projeto solicitado ‚â† projeto ativo",
          "OU estrutura n√£o existe",
          "OU comando expl√≠cito de mudan√ßa de projeto"
        ],
        "corrections": [
          "1. EXTRAIR nome do projeto do comando usando regex",
          "2. COMPARAR com active-project.json atual",
          "3. SE DIFERENTE: Atualizar active-project.json com novo projeto",
          "4. CRIAR ESTRUTURA OBRIGATORIAMENTE context/projects/[novo-projeto]/",
          "5. CRIAR project-context.json b√°sico SEMPRE",
          "6. CRIAR pasta progress para hoje SEMPRE",
          "7. ANALISAR package.json para detectar stack automaticamente",
          "8. LOG da mudan√ßa no progresso",
          "9. CONFIRMAR que contexto foi alterado com sucesso"
        ],
        "mandatory_actions": [
          "NUNCA ignorar mudan√ßa de projeto detectada",
          "SEMPRE criar contexto mesmo se projeto j√° existe",
          "SEMPRE atualizar active-project.json",
          "SEMPRE criar estrutura de pastas",
          "SEMPRE registrar mudan√ßa em logs"
        ]
      },
      {
        "step": 4,
        "action": "create_mandatory_structure",
        "description": "Cria√ß√£o autom√°tica obrigat√≥ria",
        "always_verify_and_create": [
          ".zoe/rules/context/projects/[projeto]/",
          ".zoe/rules/context/projects/[projeto]/progress/",
          ".zoe/rules/context/projects/[projeto]/progress/[hoje]/",
          ".zoe/rules/context/projects/[projeto]/project-context.json",
          ".zoe/rules/context/projects/[projeto]/progress/[hoje]/README.md"
        ],
        "commands": [
          "mkdir -p \".zoe/rules/context/projects/[projeto]/progress/$(date +%Y-%m-%d)\"",
          "Copy template se project-context.json n√£o existir",
          "Copy template se README.md progress n√£o existir"
        ]
      },
      {
        "step": 5,
        "action": "final_validation",
        "description": "Valida√ß√£o final obrigat√≥ria",
        "mandatory_checks": [
          "active-project.json aponta para projeto correto",
          "project-context.json existe e √© v√°lido",
          "Estrutura de pastas est√° criada",
          "Pasta de progresso di√°rio existe",
          "README.md de progresso existe",
          "Sistema pronto para operar no contexto correto"
        ],
        "fail_action": "PARAR execu√ß√£o, CRIAR estrutura faltante, REPETIR valida√ß√£o"
      }
    ]
  },

  "templates": {
    "project_context_template": {
      "metadata": {
        "version": "1.0",
        "created": "[timestamp]",
        "project_name": "[nome-projeto]",
        "description": "Auto-gerado pelo context-checker",
        "detection_method": "command_parsing + package.json_analysis"
      },
      "project_overview": {
        "name": "[nome-projeto]",
        "type": "Detectado automaticamente",
        "objectives": ["Extra√≠do do package.json ou definir manualmente"],
        "current_phase": "Context criado automaticamente",
        "priority_focus": "Setup e inicializa√ß√£o"
      },
      "tech_stack": {
        "auto_detected": true,
        "detection_source": "package.json analysis",
        "detection_patterns": [
          "next: Next.js detectado",
          "react: React detectado", 
          "typescript: TypeScript detectado",
          "prisma: Prisma ORM detectado",
          "@supabase: Supabase detectado"
        ]
      },
      "context_creation": {
        "triggered_by": "context-checker automatic detection",
        "project_name_source": "[comando_usuario | package.json | folder_name]",
        "needs_validation": true
      }
    },
    "folder_structure": {
      "created_structure": [
        ".zoe/rules/context/projects/[projeto]/",
        "‚îú‚îÄ‚îÄ project-context.json",
        "‚îî‚îÄ‚îÄ progress/",
        "    ‚îî‚îÄ‚îÄ [YYYY-MM-DD]/",
        "        ‚îî‚îÄ‚îÄ README.md"
      ]
    }
  },

  "integration": {
    "files_read": [
      ".zoe/rules/context/active-project.json",
      ".zoe/rules/context/projects/[projeto]/project-context.json",
      "package.json"
    ],
    "files_write": [
      ".zoe/rules/context/active-project.json",
      ".zoe/rules/context/projects/[projeto]/project-context.json",
      ".zoe/rules/context/projects/[projeto]/progress/[hoje]/README.md"
    ],
    "related_actions": [
      "project-creator",
      "stack-autodetection",
      "context-updater"
    ]
  },

  "validation": {
    "required_conditions": [
      "Sistema deve ter permiss√£o para criar diret√≥rios",
      "Projeto deve ter package.json v√°lido",
      "Nome do projeto deve ser v√°lido"
    ],
    "success_criteria": [
      "Estrutura completa criada",
      "Todos os arquivos obrigat√≥rios existem",
      "Contexto correto carregado",
      "Sistema pronto para opera√ß√£o"
    ],
    "blocking_behavior": "Este action bloqueia TODA execu√ß√£o at√© completar com sucesso"
  },

  "error_handling": {
    "common_errors": [
      {
        "error": "permission_denied",
        "description": "Sem permiss√£o para criar estrutura",
        "solution": "Verificar permiss√µes da pasta .zoe/ e projeto"
      },
      {
        "error": "invalid_project_name",
        "description": "Nome de projeto inv√°lido",
        "solution": "Usar apenas letras, n√∫meros e h√≠fens"
      },
      {
        "error": "missing_package_json",
        "description": "package.json n√£o encontrado",
        "solution": "Criar package.json b√°sico ou especificar stack manualmente"
      },
      {
        "error": "corrupted_context",
        "description": "Arquivo de contexto corrompido",
        "solution": "Recriar arquivo usando template padr√£o"
      }
    ]
  },

  "objective": {
    "primary": "Tornar IMPOSS√çVEL esquecer de atualizar contexto",
    "features": [
      "Verifica√ß√£o autom√°tica sempre",
      "Corre√ß√£o autom√°tica quando necess√°rio", 
      "Context memory sempre correto",
      "Zero interven√ß√£o manual necess√°ria"
    ]
  },

  "logging": {
    "log_format": "üîç CONTEXT CHECKER EXECUTADO:\n- Projeto solicitado: [nome]\n- Projeto ativo: [nome-atual]\n- A√ß√£o: [nenhuma | atualizado | criado]\n- Status: ‚úÖ Contexto correto",
    "log_location": ".zoe/rules/context/projects/[projeto]/progress/[hoje]/README.md"
  }
} 