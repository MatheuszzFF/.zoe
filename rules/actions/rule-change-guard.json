{
  "_metadata": {
    "action_name": "rule-change-guard",
    "version": "1.0",
    "format": "json",
    "description": "Prote√ß√£o obrigat√≥ria antes de altera√ß√µes em regras",
    "created": "2025-01-20",
    "converted_from": "rule-change-guard.mdc",
    "ai_optimized": true
  },
  
  "trigger": {
    "patterns": [
      "Vou alterar qualquer regra do sistema",
      "Detectar quando Zoe vai alterar qualquer regra",
      "Tentativa de modificar arquivos protegidos"
    ],
    "automatic": true,
    "priority_level": 1,
    "category": "security",
    "mandatory": true,
    "blocking": true
  },

  "behavior": {
    "description": "Prote√ß√£o autom√°tica contra altera√ß√µes n√£o controladas de regras",
    "protection_mechanism": "Bloquear TODA altera√ß√£o SEM executar comando 'alterar regra' antes",
    "execution_steps": [
      {
        "step": 1,
        "action": "detect_rule_change_attempt",
        "description": "Detectar tentativa de altera√ß√£o em arquivos protegidos",
        "detection_scope": "Qualquer modifica√ß√£o nos arquivos do sistema Zoe"
      },
      {
        "step": 2,
        "action": "verify_authorization",
        "description": "Verificar se comando 'alterar regra' foi executado",
        "authorization_check": [
          "Comando 'alterar regra' executado na mesma conversa",
          "Altera√ß√£o √© parte do processo change-rule.mdc"
        ]
      },
      {
        "step": 3,
        "action": "block_or_allow",
        "description": "Bloquear altera√ß√£o n√£o autorizada ou permitir se autorizada",
        "block_conditions": [
          "Comando 'alterar regra' N√ÉO foi executado",
          "Altera√ß√£o N√ÉO √© parte de processo controlado"
        ],
        "allow_conditions": [
          "Comando 'alterar regra' foi executado",
          "Altera√ß√£o √© parte do processo change-rule.mdc"
        ]
      }
    ],
    "mandatory_message": {
      "title": "‚ö†Ô∏è ATEN√á√ÉO: Altera√ß√£o de regra detectada!",
      "content": "Para manter a organiza√ß√£o do sistema, execute primeiro:\n\"alterar regra\"\n\nEste comando garante:\n- Backup da vers√£o atual\n- Verifica√ß√£o de depend√™ncias\n- Processo controlado de mudan√ßa\n- Documenta√ß√£o atualizada\n\nRepita sua solicita√ß√£o ap√≥s executar o comando."
    }
  },

  "protected_files": {
    "description": "Arquivos que requerem processo controlado para altera√ß√£o",
    "file_patterns": [
      ".zoe/rules/zoe-chore.mdc",
      ".zoe/rules/commands/*.mdc",
      ".zoe/rules/commands/*.json",
      ".zoe/rules/actions/*.mdc", 
      ".zoe/rules/actions/*.json",
      ".zoe/rules/templates/*.mdc",
      ".zoe/rules/templates/*.json",
      ".zoe/rules/context/*.mdc",
      ".zoe/rules/context/*.json",
      ".zoe/rules/workflows/*.mdc",
      ".zoe/rules/workflows/*.json",
      ".zoe/rules/patterns/*.mdc",
      ".zoe/rules/patterns/*.json",
      ".zoe/rules/priority-map.json"
    ],
    "protection_level": "HIGH - Require authorization",
    "exceptions": "Apenas durante processo change-rule autorizado"
  },

  "authorization": {
    "description": "Condi√ß√µes para permitir altera√ß√µes",
    "valid_scenarios": [
      {
        "scenario": "command_executed",
        "description": "Comando 'alterar regra' foi executado na mesma conversa",
        "verification": "Verificar hist√≥rico da conversa atual"
      },
      {
        "scenario": "controlled_process",
        "description": "Altera√ß√£o √© parte do processo change-rule.mdc",
        "verification": "Verificar se processo controlado est√° ativo"
      }
    ],
    "invalid_scenarios": [
      {
        "scenario": "direct_modification",
        "description": "Tentativa de modifica√ß√£o direta sem autoriza√ß√£o",
        "action": "BLOCK e mostrar mensagem obrigat√≥ria"
      }
    ]
  },

  "integration": {
    "files_read": [
      ".zoe/rules/commands/change-rule.json",
      "Hist√≥rico da conversa atual"
    ],
    "files_write": [
      "Log de tentativas de altera√ß√£o"
    ],
    "related_actions": [
      "change-rule",
      "auto-documentation",
      "update-docs"
    ]
  },

  "validation": {
    "required_conditions": [
      "Sistema deve monitorar tentativas de altera√ß√£o",
      "Hist√≥rico da conversa deve estar acess√≠vel",
      "Comando change-rule deve estar dispon√≠vel"
    ],
    "success_criteria": [
      "Altera√ß√µes n√£o autorizadas bloqueadas",
      "Processo controlado respeitado",
      "Mensagem educativa exibida",
      "Sistema mant√©m integridade"
    ],
    "blocking_behavior": "Bloqueia altera√ß√µes at√© autoriza√ß√£o adequada"
  },

  "error_handling": {
    "common_errors": [
      {
        "error": "unauthorized_modification",
        "description": "Tentativa de alterar regra sem autoriza√ß√£o",
        "solution": "Executar comando 'alterar regra' primeiro"
      },
      {
        "error": "missing_change_rule_command",
        "description": "Comando change-rule n√£o dispon√≠vel",
        "solution": "Verificar se arquivo change-rule.json existe"
      },
      {
        "error": "history_not_available",
        "description": "N√£o √© poss√≠vel verificar hist√≥rico da conversa",
        "solution": "Assumir n√£o autorizado e bloquear"
      }
    ]
  },

  "security": {
    "objective": "Garantir que TODAS as altera√ß√µes de regras passem pelo processo controlado",
    "protection_level": "CRITICAL",
    "enforcement": "STRICT - Zero toler√¢ncia para altera√ß√µes n√£o autorizadas",
    "logging": "Registrar todas as tentativas de altera√ß√£o"
  },

  "logging": {
    "log_format": "üõ°Ô∏è RULE CHANGE GUARD:\n- Arquivo: [arquivo]\n- A√ß√£o: [permitida | bloqueada]\n- Motivo: [autoriza√ß√£o | sem autoriza√ß√£o]\n- Timestamp: [ISO 8601]",
    "log_location": ".zoe/rules/logs/security/rule-changes.log"
  }
} 